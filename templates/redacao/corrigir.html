{% extends 'base.html' %}

{% block title %}Corrigir RedaÃ§Ã£o | Verbium{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <header class="mb-8 bg-white p-6 rounded-xl shadow-lg border">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">âœï¸ Corrigir RedaÃ§Ã£o</h1>
                <p class="text-gray-600 mt-1">{{ entrega.aluno.first_name|default:entrega.aluno.username }} - {{ entrega.tema.titulo }}</p>
            </div>
            <a href="{% url 'tarefas:entregas_tema' entrega.tema.id %}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                â† Voltar
            </a>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- RedaÃ§Ã£o do Aluno -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Texto da RedaÃ§Ã£o -->
            <div class="bg-white p-6 rounded-xl shadow-lg border">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ RedaÃ§Ã£o do Aluno</h3>
                <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                    <div class="text-gray-700 whitespace-pre-line">{{ entrega.texto }}</div>
                </div>
                <div class="text-sm text-gray-600">
                    ğŸ“Š {{ entrega.palavras_count }} palavras | ğŸ“… {{ entrega.data_entrega|date:"d/m/Y H:i" }}
                </div>
            </div>

            <!-- FormulÃ¡rio de CorreÃ§Ã£o -->
            <div class="bg-white p-6 rounded-xl shadow-lg border">
                <h3 class="text-lg font-semibold mb-6">ğŸ¯ CorreÃ§Ã£o ENEM</h3>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- CompetÃªncias ENEM -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                        <div class="bg-blue-50 p-4 rounded-lg border">
                            <label class="block text-sm font-semibold text-blue-800 mb-2">C1 - Norma Culta</label>
                            <input type="number" name="c1" min="0" max="200" step="20" 
                                   value="{% if analise_ia %}{{ analise_ia.nota_ia_c1 }}{% else %}120{% endif %}"
                                   class="w-full p-2 border border-blue-300 rounded focus:ring-2 focus:ring-blue-500">
                            <div class="text-xs text-blue-600 mt-1">0-200 pontos</div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg border">
                            <label class="block text-sm font-semibold text-green-800 mb-2">C2 - Tema</label>
                            <input type="number" name="c2" min="0" max="200" step="20"
                                   value="{% if analise_ia %}{{ analise_ia.nota_ia_c2 }}{% else %}120{% endif %}"
                                   class="w-full p-2 border border-green-300 rounded focus:ring-2 focus:ring-green-500">
                            <div class="text-xs text-green-600 mt-1">0-200 pontos</div>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg border">
                            <label class="block text-sm font-semibold text-yellow-800 mb-2">C3 - ArgumentaÃ§Ã£o</label>
                            <input type="number" name="c3" min="0" max="200" step="20"
                                   value="{% if analise_ia %}{{ analise_ia.nota_ia_c3 }}{% else %}120{% endif %}"
                                   class="w-full p-2 border border-yellow-300 rounded focus:ring-2 focus:ring-yellow-500">
                            <div class="text-xs text-yellow-600 mt-1">0-200 pontos</div>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg border">
                            <label class="block text-sm font-semibold text-purple-800 mb-2">C4 - CoesÃ£o</label>
                            <input type="number" name="c4" min="0" max="200" step="20"
                                   value="{% if analise_ia %}{{ analise_ia.nota_ia_c4 }}{% else %}120{% endif %}"
                                   class="w-full p-2 border border-purple-300 rounded focus:ring-2 focus:ring-purple-500">
                            <div class="text-xs text-purple-600 mt-1">0-200 pontos</div>
                        </div>
                        
                        <div class="bg-red-50 p-4 rounded-lg border">
                            <label class="block text-sm font-semibold text-red-800 mb-2">C5 - Proposta</label>
                            <input type="number" name="c5" min="0" max="200" step="20"
                                   value="{% if analise_ia %}{{ analise_ia.nota_ia_c5 }}{% else %}120{% endif %}"
                                   class="w-full p-2 border border-red-300 rounded focus:ring-2 focus:ring-red-500">
                            <div class="text-xs text-red-600 mt-1">0-200 pontos</div>
                        </div>
                    </div>

                    <!-- Total -->
                    <div class="text-center mb-8 p-4 bg-gray-50 rounded-lg border">
                        <div class="text-2xl font-bold text-gray-800" id="nota-total">600</div>
                        <div class="text-sm text-gray-600">Nota Total / 1000</div>
                    </div>

                    <!-- ComentÃ¡rios por CompetÃªncia -->
                    <div class="space-y-4 mb-8">
                        <div>
                            <label class="block text-sm font-semibold text-blue-800 mb-2">ğŸ’¬ ComentÃ¡rio C1 - Norma Culta</label>
                            <textarea name="comentario_c1" rows="2" 
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                      placeholder="ComentÃ¡rios sobre domÃ­nio da norma culta...">{% if analise_ia %}{{ analise_ia.sugestao_c1 }}{% endif %}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-green-800 mb-2">ğŸ’¬ ComentÃ¡rio C2 - Tema e Tipologia</label>
                            <textarea name="comentario_c2" rows="2"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                      placeholder="ComentÃ¡rios sobre compreensÃ£o do tema...">{% if analise_ia %}{{ analise_ia.sugestao_c2 }}{% endif %}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800 mb-2">ğŸ’¬ ComentÃ¡rio C3 - ArgumentaÃ§Ã£o</label>
                            <textarea name="comentario_c3" rows="2"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500"
                                      placeholder="ComentÃ¡rios sobre argumentaÃ§Ã£o...">{% if analise_ia %}{{ analise_ia.sugestao_c3 }}{% endif %}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-purple-800 mb-2">ğŸ’¬ ComentÃ¡rio C4 - CoesÃ£o</label>
                            <textarea name="comentario_c4" rows="2"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                      placeholder="ComentÃ¡rios sobre coesÃ£o e coerÃªncia...">{% if analise_ia %}{{ analise_ia.sugestao_c4 }}{% endif %}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-red-800 mb-2">ğŸ’¬ ComentÃ¡rio C5 - Proposta de IntervenÃ§Ã£o</label>
                            <textarea name="comentario_c5" rows="2"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                                      placeholder="ComentÃ¡rios sobre proposta de intervenÃ§Ã£o...">{% if analise_ia %}{{ analise_ia.sugestao_c5 }}{% endif %}</textarea>
                        </div>
                    </div>

                    <!-- ComentÃ¡rio Geral -->
                    <div class="mb-8">
                        <label class="block text-sm font-semibold text-gray-800 mb-2">ğŸ“ ComentÃ¡rio Geral</label>
                        <textarea name="comentario_geral" rows="4"
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                  placeholder="ComentÃ¡rio geral sobre a redaÃ§Ã£o...">{% if analise_ia %}{{ analise_ia.analise_geral }}{% endif %}</textarea>
                    </div>

                    <!-- BotÃ£o de Salvar -->
                    <div class="text-center">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg text-lg">
                            âœ… Finalizar CorreÃ§Ã£o
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Painel Lateral -->
        <div class="lg:col-span-1 space-y-6">
            
            <!-- AnÃ¡lise da IA -->
            {% if analise_ia %}
            <div class="bg-white p-6 rounded-xl shadow-lg border">
                <h3 class="text-lg font-semibold mb-4 text-purple-600">ğŸ¤– SugestÃ£o da IA</h3>
                <div class="text-center mb-4">
                    <div class="text-2xl font-bold text-purple-600">{{ analise_ia.nota_total_ia }}/1000</div>
                    <div class="text-sm text-gray-600">Nota sugerida</div>
                </div>
                
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>C1:</span>
                        <span class="font-semibold">{{ analise_ia.nota_ia_c1 }}/200</span>
                    </div>
                    <div class="flex justify-between">
                        <span>C2:</span>
                        <span class="font-semibold">{{ analise_ia.nota_ia_c2 }}/200</span>
                    </div>
                    <div class="flex justify-between">
                        <span>C3:</span>
                        <span class="font-semibold">{{ analise_ia.nota_ia_c3 }}/200</span>
                    </div>
                    <div class="flex justify-between">
                        <span>C4:</span>
                        <span class="font-semibold">{{ analise_ia.nota_ia_c4 }}/200</span>
                    </div>
                    <div class="flex justify-between">
                        <span>C5:</span>
                        <span class="font-semibold">{{ analise_ia.nota_ia_c5 }}/200</span>
                    </div>
                </div>
                
                <div class="mt-4">
                    <button onclick="usarNotasIA()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg text-sm">
                        ğŸ¤– Usar Notas da IA
                    </button>
                </div>
            </div>
            {% endif %}
            
            <!-- InformaÃ§Ãµes do Aluno -->
            <div class="bg-white p-6 rounded-xl shadow-lg border">
                <h3 class="text-lg font-semibold mb-4">ğŸ‘¨ğŸ“ InformaÃ§Ãµes</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Aluno:</span>
                        <span class="font-semibold">{{ entrega.aluno.first_name|default:entrega.aluno.username }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Entrega:</span>
                        <span class="font-semibold">{{ entrega.data_entrega|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Palavras:</span>
                        <span class="font-semibold">{{ entrega.palavras_count }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Status:</span>
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-semibold">
                            {{ entrega.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- CritÃ©rios ENEM -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border">
                <h3 class="text-lg font-semibold mb-4 text-blue-800">ğŸ“‹ CritÃ©rios ENEM</h3>
                <div class="text-xs text-blue-700 space-y-2">
                    <div><strong>C1:</strong> Norma culta da lÃ­ngua</div>
                    <div><strong>C2:</strong> CompreensÃ£o do tema</div>
                    <div><strong>C3:</strong> ArgumentaÃ§Ã£o consistente</div>
                    <div><strong>C4:</strong> CoesÃ£o e coerÃªncia</div>
                    <div><strong>C5:</strong> Proposta de intervenÃ§Ã£o</div>
                </div>
                
                <div class="mt-4 text-xs text-blue-600">
                    <div><strong>NÃ­veis:</strong></div>
                    <div>0-40: Insuficiente</div>
                    <div>60-100: Regular</div>
                    <div>120-160: Bom</div>
                    <div>180-200: Excelente</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Calcular nota total automaticamente
function calcularTotal() {
    const c1 = parseInt(document.querySelector('input[name="c1"]').value) || 0;
    const c2 = parseInt(document.querySelector('input[name="c2"]').value) || 0;
    const c3 = parseInt(document.querySelector('input[name="c3"]').value) || 0;
    const c4 = parseInt(document.querySelector('input[name="c4"]').value) || 0;
    const c5 = parseInt(document.querySelector('input[name="c5"]').value) || 0;
    
    const total = c1 + c2 + c3 + c4 + c5;
    document.getElementById('nota-total').textContent = total;
}

// Usar notas sugeridas pela IA
function usarNotasIA() {
    {% if analise_ia %}
    document.querySelector('input[name="c1"]').value = {{ analise_ia.nota_ia_c1 }};
    document.querySelector('input[name="c2"]').value = {{ analise_ia.nota_ia_c2 }};
    document.querySelector('input[name="c3"]').value = {{ analise_ia.nota_ia_c3 }};
    document.querySelector('input[name="c4"]').value = {{ analise_ia.nota_ia_c4 }};
    document.querySelector('input[name="c5"]').value = {{ analise_ia.nota_ia_c5 }};
    calcularTotal();
    {% endif %}
}

// Adicionar listeners para recalcular total
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input[type="number"]');
    inputs.forEach(input => {
        input.addEventListener('input', calcularTotal);
    });
    calcularTotal(); // Calcular inicial
});
</script>
{% endblock %}